<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
    <title>ì•”ë³´í—˜ ì¶”ì²œ - ê±°ë¶ì´ ë³´í—˜</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"/>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f8f9fa;
            padding-top: 80px;
        }
        .custom-navbar {
            background-color: #1c2f48;
            border-bottom: 1px solid rgba(0,0,0,.25);
            padding: 8px 20px;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }
        .custom-navbar .navbar-brand {
            color: #d4b46b !important;
            font-weight: 900;
            font-size: 40px;
            margin-right: 30px;
        }
        .custom-navbar .nav-link {
            color: #d4b46b !important;
            font-weight: 800;
            font-size: 20px;
            margin-right: 36px;
        }
        .custom-navbar .nav-link:hover {
            color: #e5c57b !important;
        }
        .recommend-form {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            padding: 2rem;
            margin-bottom: 2rem;
        }
        .form-label {
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
        }
        .form-control, .form-select {
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 0.75rem 1rem;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        .form-control:focus, .form-select:focus {
            border-color: #d4b46b;
            box-shadow: 0 0 0 0.2rem rgba(212,180,107,0.25);
        }
        .btn-primary {
            background-color: #1c2f48;
            border-color: #1c2f48;
            color: #d4b46b;
            border-radius: 10px;
            padding: 0.75rem 2rem;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            background-color: #2a4a6f;
            border-color: #2a4a6f;
            color: #e5c57b;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(28,47,72,0.3);
        }
        .result-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(28,47,72,0.1);
            margin-bottom: 1.5rem;
            border-left: 5px solid #d4b46b;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        .result-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .product-header {
            background: linear-gradient(135deg, #1c2f48 0%, #2a4a6f 100%);
            color: #d4b46b;
            padding: 1.5rem;
        }
        .company-name {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        .product-name {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }
        .product-details {
            padding: 1.5rem;
        }
        .detail-item {
            margin-bottom: 1rem;
        }
        .detail-label {
            font-weight: 600;
            color: #666;
            margin-bottom: 0.3rem;
            font-size: 0.9rem;
        }
        .detail-value {
            font-weight: 700;
            color: #333;
            font-size: 1.1rem;
        }
        .preset-section {
            margin-bottom: 2rem;
        }
        .preset-title {
            font-weight: 700;
            color: #333;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }
        .preset-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 1.2rem;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .preset-card:hover {
            border-color: #d4b46b;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .preset-card.selected {
            border-color: #d4b46b;
            background: linear-gradient(135deg, #faf8f3, #f5f1e8);
        }
        .preset-title-text {
            font-weight: 700;
            color: #333;
            margin-bottom: 0.3rem;
            font-size: 1rem;
        }
        .preset-desc {
            color: #666;
            font-size: 0.9rem;
        }
        .results-section {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            padding: 2rem;
            min-height: 600px;
        }
        .coverage-summary {
            display: inline-flex;
            align-items: center;
            background: linear-gradient(135deg, #1c2f48, #2a4a6f);
            color: #d4b46b;
            padding: 0.6rem 1.2rem;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 0.9rem;
        }
        .coverage-summary:hover {
            background: linear-gradient(135deg, #14c738, #12b834);
            transform: translateY(-1px);
        }
        .coverage-summary.active {
            background: linear-gradient(135deg, #14c738, #12b834);
        }
        .coverage-icon {
            margin-right: 0.5rem;
        }
        .coverage-arrow {
            margin-left: 0.5rem;
            transition: transform 0.3s ease;
        }
        .coverage-details {
            margin-top: 1rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #d4b46b;
        }
        .coverage-content h6 {
            font-weight: 700;
            color: #333;
            margin-bottom: 1rem;
        }
        .coverage-item {
            background: white;
            padding: 0.8rem;
            margin-bottom: 0.5rem;
            border-radius: 6px;
            font-size: 0.9rem;
            color: #555;
            border-left: 3px solid #d4b46b;
        }
        .coverage-note {
            font-size: 0.8rem;
            color: #888;
            margin-top: 1rem;
            font-style: italic;
        }
        .initial-message {
            text-align: center;
            color: #666;
            font-size: 1.1rem;
            margin-top: 3rem;
        }
        .loading-spinner {
            display: none;
            text-align: center;
            margin: 2rem 0;
        }
        .spinner-border {
            color: #1c2f48;
        }
        .result-count {
            font-weight: 600;
            color: #1c2f48;
            margin-bottom: 1rem;
        }
        .section-title {
            font-weight: 700;
            color: #333;
            margin-bottom: 1.5rem;
            font-size: 1.3rem;
            border-bottom: 3px solid #d4b46b;
            padding-bottom: 0.5rem;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="custom-navbar navbar navbar-expand-lg">
        <div class="container-fluid">
            <a class="navbar-brand" href="/main" style="color:#d4b46b; font-weight:900;">
                B
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/savings/recommend">ì—°ê¸ˆë³´í—˜</a>
                <a class="nav-link active" href="/cancer/recommend">ì•”ë³´í—˜</a>
                <a class="nav-link" href="/life/recommend">ì¢…ì‹ ë³´í—˜</a>
                <a class="nav-link" href="/user/myPage">ë§ˆì´í˜ì´ì§€</a>
                <a class="nav-link" href="/user/logout">ë¡œê·¸ì•„ì›ƒ</a>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- ì™¼ìª½ ì¶”ì²œ ì„¤ì • -->
            <div class="col-md-4">
                <div class="recommend-form">
                    <h3 class="section-title">ë§ì¶¤í˜• ì•”ë³´í—˜ ì¶”ì²œ</h3>

                    <!-- í”„ë¦¬ì…‹ ì„ íƒ -->
                    <div class="preset-section">
                        <div class="preset-title">ì¶”ì²œ ìŠ¤íƒ€ì¼</div>

                        <div class="preset-card" onclick="selectPreset('coverage', event)">
                            <div class="preset-title-text">ë³´ì¥ê¸ˆì•¡ ì¤‘ì‹¬</div>
                            <div class="preset-desc">ìµœëŒ€ ë³´ì¥ê¸ˆì•¡ ìš°ì„ </div>
                        </div>

                        <div class="preset-card" onclick="selectPreset('value', event)">
                            <div class="preset-title-text">ê°€ì„±ë¹„ ì¤‘ì‹¬</div>
                            <div class="preset-desc">ë³´ì¥ê³¼ ë³´í—˜ë£Œì˜ ê· í˜•</div>
                        </div>

                        <div class="preset-card" onclick="selectPreset('stability', event)">
                            <div class="preset-title-text">ì•ˆì •ì„± ì¤‘ì‹¬</div>
                            <div class="preset-desc">ë‚®ì€ ë³´í—˜ë£Œ ìš°ì„ </div>
                        </div>
                    </div>

                    <!-- ìƒì„¸ ì„¤ì • -->
                    <form id="recommendForm">
                        <div class="mb-3">
                            <label class="form-label">ìµœì†Œ ë³´ì¥ê¸ˆì•¡ì€?</label>
                            <select class="form-select" id="minCoverage" name="minCoverage">
                                <option value="10000000">1ì²œë§Œì›</option>
                                <option value="15000000">1ì²œ5ë°±ë§Œì›</option>
                                <option value="20000000">2ì²œë§Œì›</option>
                                <option value="25000000">2ì²œ5ë°±ë§Œì›</option>
                                <option value="30000000" selected>3ì²œë§Œì›</option>
                                <option value="50000000">5ì²œë§Œì›</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">ì›” ë³´í—˜ë£Œ ì˜ˆì‚°ì€?</label>
                            <select class="form-select" id="maxPremium" name="maxPremium">
                                <option value="10000">1ë§Œì› ì´í•˜</option>
                                <option value="15000">1ë§Œ5ì²œì› ì´í•˜</option>
                                <option value="20000" selected>2ë§Œì› ì´í•˜</option>
                                <option value="25000">2ë§Œ5ì²œì› ì´í•˜</option>
                                <option value="30000">3ë§Œì› ì´í•˜</option>
                                <option value="50000">5ë§Œì› ì´í•˜</option>
                                <option value="100000">10ë§Œì› ì´í•˜</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">ê°±ì‹  ë°©ì‹ì€?</label>
                            <select class="form-select" id="renewalType" name="renewalType">
                                <option value="neutral" selected>ìƒê´€ì—†ìŒ</option>
                                <option value="non-renewal">ê°±ì‹  ì—†ìŒ</option>
                                <option value="renewal">ê°±ì‹  ìˆìŒ</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">íŒë§¤ ì±„ë„ì€?</label>
                            <select class="form-select" id="salesChannel" name="salesChannel">
                                <option value="" selected>ìƒê´€ì—†ìŒ</option>
                                <option value="ì˜¨ë¼ì¸">ì˜¨ë¼ì¸</option>
                                <option value="ì˜¤í”„ë¼ì¸">ì˜¤í”„ë¼ì¸</option>
                                <option value="ëª¨ë°”ì¼">ëª¨ë°”ì¼</option>
                            </select>
                        </div>

                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-search me-2"></i>ë§ì¶¤í˜• ì•”ë³´í—˜ ì°¾ê¸°
                        </button>
                    </form>
                </div>
            </div>

            <!-- ê°€ìš´ë° ê²°ê³¼ -->
            <div class="col-md-8">
                <div class="results-section">
                    <h3 class="section-title">ì¶”ì²œ ê²°ê³¼</h3>

                    <div class="initial-message">
                        <i class="fas fa-shield-alt fa-3x mb-3" style="color: #6c757d;"></i>
                        <h5 style="font-weight: 700; color: #333; margin-bottom: 0.5rem;">ì™¼ìª½ ì„¤ì •ì„ ì¡°ì •í•˜ê³  "ë§ì¶¤í˜• ì•”ë³´í—˜ ì°¾ê¸°"ë¥¼ í´ë¦­í•˜ì„¸ìš”!</h5>
                        <p style="color: #999; font-size: 1rem;">ë‹¹ì‹ ì—ê²Œ ìµœì í™”ëœ ì•”ë³´í—˜ì„ ì°¾ì•„ë“œë¦½ë‹ˆë‹¤.</p>
                    </div>

                    <div class="loading-spinner" id="loadingSpinner">
                        <div class="spinner-border" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-2">ìµœì ì˜ ì•”ë³´í—˜ì„ ì°¾ê³  ìˆìŠµë‹ˆë‹¤...</p>
                    </div>

                    <div id="resultsContainer"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // closest í•¨ìˆ˜ í´ë°± (êµ¬í˜• ë¸Œë¼ìš°ì € ì§€ì›)
        function findClosestElement(element, selector) {
            while (element && element.nodeType === 1) {
                if (element.matches && element.matches(selector)) {
                    return element;
                }
                element = element.parentElement;
            }
            return null;
        }

        // í”„ë¦¬ì…‹ ì„ íƒ í•¨ìˆ˜
        function selectPreset(type, event) {
            // ëª¨ë“  í”„ë¦¬ì…‹ ì¹´ë“œì—ì„œ selected í´ë˜ìŠ¤ ì œê±°
            document.querySelectorAll('.preset-card').forEach(card => {
                card.classList.remove('selected');
            });

            // ì„ íƒëœ ì¹´ë“œì— selected í´ë˜ìŠ¤ ì¶”ê°€ (eventê°€ ìˆì„ ë•Œë§Œ)
            if (event) {
                const target = event.target || event.srcElement;
                const closestElement = target.closest ? target.closest('.preset-card') : findClosestElement(target, '.preset-card');
                if (closestElement) {
                    closestElement.classList.add('selected');
                }
            } else {
                // eventê°€ ì—†ì„ ë•ŒëŠ” í•´ë‹¹ íƒ€ì…ì˜ í”„ë¦¬ì…‹ ì¹´ë“œë¥¼ ì°¾ì•„ì„œ ì„ íƒ
                const presetCard = document.querySelector(`.preset-card[onclick*="${type}"]`);
                if (presetCard) {
                    presetCard.classList.add('selected');
                }
            }

            // í”„ë¦¬ì…‹ì— ë”°ë¥¸ ì„¤ì •ê°’ ì¡°ì • (ì‹¤ì œ ë°ì´í„° ë²”ìœ„ì— ë§ê²Œ ìˆ˜ì •)
            if (type === 'coverage') {
                // ë³´ì¥ê¸ˆì•¡ ì¤‘ì‹¬: ë†’ì€ ë³´ì¥ê¸ˆì•¡ ìš°ì„  (ì¡°ê±´ ì™„í™”)
                document.getElementById('minCoverage').value = '20000000';
                document.getElementById('maxPremium').value = '50000';
            } else if (type === 'value') {
                // ê°€ì„±ë¹„ ì¤‘ì‹¬: ë³´ì¥ê³¼ ë³´í—˜ë£Œì˜ ê· í˜• (ì¡°ê±´ ì™„í™”)
                document.getElementById('minCoverage').value = '15000000';
                document.getElementById('maxPremium').value = '30000';
            } else if (type === 'stability') {
                // ì•ˆì •ì„± ì¤‘ì‹¬: ë‚®ì€ ë³´í—˜ë£Œ ìš°ì„  (ì¡°ê±´ ì™„í™”)
                document.getElementById('minCoverage').value = '10000000';
                document.getElementById('maxPremium').value = '20000';
            }
        }

        // í¼ ì œì¶œ ì²˜ë¦¬
        document.getElementById('recommendForm').addEventListener('submit', function(e) {
            e.preventDefault();

            // ë¡œë”© í‘œì‹œ
            document.querySelector('.initial-message').style.display = 'none';
            document.getElementById('loadingSpinner').style.display = 'block';
            document.getElementById('resultsContainer').innerHTML = '';

            // í¼ ë°ì´í„° ìˆ˜ì§‘
            const formData = new FormData(this);
            const data = {
                minCoverage: parseInt(formData.get('minCoverage')),
                maxPremium: parseInt(formData.get('maxPremium')),
                renewalType: formData.get('renewalType'),
                salesChannel: formData.get('salesChannel'),
                coverageWeight: 30,
                valueWeight: 50,
                stabilityWeight: 20
            };

            // ì„ íƒëœ í”„ë¦¬ì…‹ì— ë”°ë¥¸ ê°€ì¤‘ì¹˜ ì¡°ì •
            const selectedPreset = document.querySelector('.preset-card.selected');
            if (selectedPreset) {
                const presetTitle = selectedPreset.querySelector('.preset-title-text').textContent;
                if (presetTitle === 'ë³´ì¥ê¸ˆì•¡ ì¤‘ì‹¬') {
                    data.coverageWeight = 70;
                    data.valueWeight = 20;
                    data.stabilityWeight = 10;
                } else if (presetTitle === 'ê°€ì„±ë¹„ ì¤‘ì‹¬') {
                    data.coverageWeight = 30;
                    data.valueWeight = 50;
                    data.stabilityWeight = 20;
                } else if (presetTitle === 'ì•ˆì •ì„± ì¤‘ì‹¬') {
                    data.coverageWeight = 10;
                    data.valueWeight = 20;
                    data.stabilityWeight = 70;
                }
            }

            // API í˜¸ì¶œ
            fetch('/cancer/recommend/api', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('loadingSpinner').style.display = 'none';
                displayResults(data.recommendations || []);
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('loadingSpinner').style.display = 'none';
                document.getElementById('resultsContainer').innerHTML =
                    '<div class="alert alert-danger">ì¶”ì²œì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
            });
        });

        // ê´€ì‹¬ ìƒí’ˆì— ì¶”ê°€
        let currentRecommendations = [];

        // ê²°ê³¼ í‘œì‹œ í•¨ìˆ˜
        function displayResults(recommendations) {
            currentRecommendations = recommendations; // ì €ì¥
            const container = document.getElementById('resultsContainer');

            if (!recommendations || recommendations.length === 0) {
                container.innerHTML = `
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        ì¡°ê±´ì— ë§ëŠ” ì•”ë³´í—˜ ìƒí’ˆì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ì¡°ê±´ìœ¼ë¡œ ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”.
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <div class="result-count">
                    <i class="fas fa-check-circle me-2"></i>
                    ì´ ${recommendations.length}ê°œì˜ ë§ì¶¤í˜• ì•”ë³´í—˜ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤!
                </div>
            `;

            recommendations.forEach((rec, index) => {
                const card = document.createElement('div');
                card.className = 'result-card';
                card.innerHTML = `
                    <div class="product-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <div class="company-name">${rec.insuranceCompany || 'ì •ë³´ì—†ìŒ'}</div>
                                <div class="product-name">${rec.productName || 'ìƒí’ˆëª… ì—†ìŒ'}</div>
                            </div>
                            <div class="text-end">
                                <div class="coverage-summary" onclick="toggleCoverageDetails(${index})">
                                    <span class="coverage-icon">ğŸ›¡ï¸</span>
                                    <span class="coverage-text">ë³´ì¥ ë‚´ìš© ë³´ê¸°</span>
                                    <span class="coverage-arrow">â–¼</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="product-details">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="detail-item">
                                    <div class="detail-label">ë³´ì¥ê¸ˆì•¡</div>
                                    <div class="detail-value">${rec.coverageAmount ? rec.coverageAmount.toLocaleString() + 'ì›' : 'ì •ë³´ì—†ìŒ'}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">ì›” ë³´í—˜ë£Œ</div>
                                    <div class="detail-value">${rec.avgPremium ? rec.avgPremium.toLocaleString() + 'ì›' : 'ì •ë³´ì—†ìŒ'}</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="detail-item">
                                    <div class="detail-label">ê°±ì‹ í˜•</div>
                                    <div class="detail-value">${rec.renewalCycle || 'ì •ë³´ì—†ìŒ'}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">íŒë§¤ì±„ë„</div>
                                    <div class="detail-value">${rec.salesChannel || 'ì •ë³´ì—†ìŒ'}</div>
                                </div>
                            </div>
                        </div>
                        <div class="coverage-details" id="details-${index}" style="display: none;">
                            <div class="coverage-content">
                                <h6>ì£¼ìš” ë³´ì¥ ë‚´ìš©</h6>
                                <div class="coverage-content" data-product-index="${index}">
                                    <div class="coverage-item">ë³´ì¥ ë‚´ìš© ë¡œë”© ì¤‘...</div>
                                </div>
                                <div class="coverage-note">
                                    â€» ìƒì„¸í•œ ë³´ì¥ ì¡°ê±´ê³¼ ì§€ê¸‰ í•œë„ëŠ” ê° ìƒí’ˆì˜ ì•½ê´€ì„ ì°¸ì¡°í•˜ì„¸ìš”.
                                </div>
                            </div>
                        </div>

                        <!-- ê´€ì‹¬ ìƒí’ˆ ì¶”ê°€ ë²„íŠ¼ -->
                        <div class="text-end mt-3">
                            <button class="btn btn-primary" onclick="addToCart(${index})">
                                ê´€ì‹¬ ìƒí’ˆ
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(card);

                // ë³´ì¥ ë‚´ìš© ë™ì  ë Œë”ë§
                const coverageContentDiv = card.querySelector('[data-product-index="' + index + '"]');
                if (rec.coverageDetails && rec.coverageDetails.length > 0) {
                    coverageContentDiv.innerHTML = rec.coverageDetails.map(detail =>
                        `<div class="coverage-item">${detail}</div>`
                    ).join('');
                } else {
                    coverageContentDiv.innerHTML = '<div class="coverage-item">ë³´ì¥ ë‚´ìš© ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
                }
            });
        }

        // ë³´ì¥ ë‚´ìš© í† ê¸€ í•¨ìˆ˜
        function toggleCoverageDetails(index) {
            const detailsElement = document.getElementById('details-' + index);
            const summaryElement = detailsElement.previousElementSibling.querySelector('.coverage-summary');

            if (detailsElement.style.display === 'none' || detailsElement.style.display === '') {
                // ë‹¤ë¥¸ ëª¨ë“  ë³´ì¥ ë‚´ìš© ìˆ¨ê¸°ê¸°
                document.querySelectorAll('.coverage-details').forEach(el => {
                    if (el.id !== 'details-' + index) {
                        el.style.display = 'none';
                        const otherSummary = el.previousElementSibling.querySelector('.coverage-summary');
                        if (otherSummary) {
                            otherSummary.classList.remove('active');
                            const arrow = otherSummary.querySelector('.coverage-arrow');
                            arrow.textContent = 'â–¼';
                        }
                    }
                });

                // í˜„ì¬ ë³´ì¥ ë‚´ìš© ë³´ì´ê¸°
                detailsElement.style.display = 'block';
                summaryElement.classList.add('active');

                // í™”ì‚´í‘œ íšŒì „
                const arrow = summaryElement.querySelector('.coverage-arrow');
                arrow.textContent = 'â–²';
            } else {
                // í˜„ì¬ ë³´ì¥ ë‚´ìš© ìˆ¨ê¸°ê¸°
                detailsElement.style.display = 'none';
                summaryElement.classList.remove('active');

                // í™”ì‚´í‘œ ì›ë˜ëŒ€ë¡œ
                const arrow = summaryElement.querySelector('.coverage-arrow');
                arrow.textContent = 'â–¼';
            }
        }

        // ê´€ì‹¬ ìƒí’ˆì— ì¶”ê°€
        function addToCart(index) {
            const product = currentRecommendations[index];
            if (!product) {
                alert('ìƒí’ˆ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const cartData = {
                insuranceType: "ì•”ë³´í—˜",
                insuranceCompany: product.insuranceCompany || product.company || '',
                productName: product.productName || product.product_name || '',
                coverageAmount: product.coverageAmount ? product.coverageAmount.toString() : (product.coverage_amount || ''),
                malePremium: product.malePremium ? product.malePremium.toString() + 'ì›' : (product.male_premium || ''),
                femalePremium: product.femalePremium ? product.femalePremium.toString() + 'ì›' : (product.female_premium || ''),
                renewalCycle: product.renewalCycle || product.renewal_cycle || '',
                term: product.term || '',
                salesChannel: product.salesChannel || product.sales_channel || '',
                recommendationReason: product.recommendationReason || product.recommendation_reason || ''
            };

            fetch('/cart/add', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(cartData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(data.message);
                    // ê´€ì‹¬ ìƒí’ˆ ê°œìˆ˜ ì—…ë°ì´íŠ¸ (ë„¤ë¹„ê²Œì´ì…˜ ë°”ì— í‘œì‹œëœë‹¤ë©´)
                } else {
                    if (data.message.includes('ë¡œê·¸ì¸')) {
                        if (confirm('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                            window.location.href = '/user/login';
                        }
                    } else {
                        alert(data.message);
                    }
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('ê´€ì‹¬ ìƒí’ˆ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            });
        }

        // í˜ì´ì§€ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            // ê¸°ë³¸ í”„ë¦¬ì…‹ ì„ íƒ (event ê°ì²´ ì—†ì´ í˜¸ì¶œ)
            selectPreset('value', null);
        });
    </script>
</body>
</html>