<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
    <title>íŠ¹ì„±ê¸°ë°˜ ì•”ë³´í—˜ ì¶”ì²œ - ê±°ë¶ì´ ë³´í—˜</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"/>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f8f9fa;
            padding-top: 90px;
        }
        .custom-navbar {
            background-color: #1c2f48;
            border-bottom: 1px solid rgba(0,0,0,.25);
            padding: 8px 20px;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }
        .custom-navbar .navbar-brand {
            color: #d4b46b !important;
            font-weight: 900;
            font-size: 40px;
            margin-right: 30px;
        }
        .custom-navbar .nav-link {
            color: #d4b46b !important;
            font-weight: 800;
            font-size: 20px;
            margin-right: 36px;
        }
        .custom-navbar .nav-link:hover {
            color: #e5c57b !important;
        }
        .container-fluid {
            padding: 2rem;
        }
        .recommend-form {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            padding: 2rem;
            margin-bottom: 2rem;
        }
        .section-title {
            color: #333;
            font-weight: 700;
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
        }
        .form-label {
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
        }
        .form-control, .form-select {
            border-radius: 10px;
            border: 2px solid #e9ecef;
            padding: 0.75rem 1rem;
        }
        .form-control:focus, .form-select:focus {
            border-color: #d4b46b;
            box-shadow: 0 0 0 0.2rem rgba(212,180,107,0.25);
        }
        .btn-recommend {
            background-color: #1c2f48;
            color: #d4b46b;
            border: none;
            border-radius: 25px;
            padding: 0.75rem 2rem;
            font-weight: 600;
            font-size: 1.1rem;
            width: 100%;
        }
        .btn-recommend:hover {
            background-color: #15d65a;
            transform: translateY(-2px);
        }
        .results-section {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            padding: 2rem;
            min-height: 600px;
        }
        .initial-message {
            text-align: center;
            color: #666;
            font-size: 1.1rem;
            margin-top: 3rem;
        }
        .loading-spinner {
            display: none;
            text-align: center;
            margin: 2rem 0;
        }
        .result-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: transform 0.2s ease;
            border-left: 4px solid #d4b46b;
        }
        .result-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .product-header {
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e9ecef;
        }
        .company-name {
            color: #1c2f48;
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 0.3rem;
        }
        .product-name {
            color: #333;
            font-weight: 600;
            font-size: 1rem;
        }
        .product-details {
            margin-top: 1rem;
        }
        .detail-item {
            margin-bottom: 0.8rem;
        }
        .detail-label {
            color: #666;
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 0.2rem;
        }
        .detail-value {
            color: #333;
            font-size: 1rem;
            font-weight: 600;
        }
        .coverage-summary {
            background: #e8f5e8;
            border-radius: 8px;
            padding: 0.8rem;
            margin-top: 1rem;
            cursor: pointer;
            transition: background-color 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .coverage-summary:hover {
            background: #d4edda;
        }
        .coverage-icon {
            color: #d4b46b;
            font-size: 1.1rem;
            margin-right: 0.5rem;
        }
        .coverage-arrow {
            color: #666;
            font-size: 0.9rem;
        }
        .coverage-details {
            margin-top: 1rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        .coverage-content {
            font-size: 0.9rem;
        }
        .coverage-item {
            background: white;
            padding: 0.8rem;
            margin-bottom: 0.5rem;
            border-radius: 6px;
            border-left: 3px solid #d4b46b;
            font-size: 0.85rem;
            line-height: 1.4;
        }
        .coverage-note {
            margin-top: 1rem;
            padding: 0.8rem;
            background: #fff3cd;
            border-radius: 6px;
            font-size: 0.8rem;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .score-badge {
            background-color: #1c2f48;
            color: #d4b46b;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-top: 0.5rem;
            display: inline-block;
        }
        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }
        .spinner-border {
            color: #1c2f48;
        }
        .initial-message {
            text-align: center;
            color: #666;
            font-size: 1.1rem;
            padding: 3rem;
        }
        .result-count {
            color: #1c2f48;
            font-weight: 600;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>

<nav class="custom-navbar navbar navbar-expand-lg">
    <div class="container-fluid">
        <a class="navbar-brand" href="/main" style="color:#d4b46b; font-weight:900;">
            B
        </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/savings/recommend">ì—°ê¸ˆë³´í—˜</a>
                <a class="nav-link active" href="/cancer/recommend">ì•”ë³´í—˜</a>
                <a class="nav-link" href="/life/recommend">ì¢…ì‹ ë³´í—˜</a>
                <a class="nav-link" href="/user/myPage">ë§ˆì´í˜ì´ì§€</a>
                <a class="nav-link" href="/user/logout">ë¡œê·¸ì•„ì›ƒ</a>
            </div>
    </div>
</nav>

<div class="container-fluid">
    <div class="row">
        <!-- ì™¼ìª½ ì¶”ì²œ ì„¤ì • -->
        <div class="col-md-4">
            <div class="recommend-form">
                <h3 class="section-title">
                    <i class="fas fa-user-md me-2"></i>ë§ì¶¤í˜• ì•”ë³´í—˜ ì¶”ì²œ
                </h3>
                <p class="text-muted mb-4">ë‚˜ì´, ì„±ë³„, ì§ì—…, ì˜ˆì‚° ë“± ë‹¹ì‹ ì˜ íŠ¹ì„±ë§Œìœ¼ë¡œ ìµœì ì˜ ì•”ë³´í—˜ì„ ì¶”ì²œë°›ìœ¼ì„¸ìš”</p>

                <form id="profileForm">
                    <div class="mb-3">
                        <label for="age" class="form-label">ë‚˜ì´</label>
                        <input type="number" class="form-control" id="age" name="age"
                               placeholder="ì˜ˆ: 35" min="18" max="80" required>
                    </div>

                    <div class="mb-3">
                        <label for="sex" class="form-label">ì„±ë³„</label>
                        <select class="form-select" id="sex" name="sex" required>
                            <option value="">ì„±ë³„ì„ ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="M">ë‚¨ì„±</option>
                            <option value="F">ì—¬ì„±</option>
                        </select>
                    </div>


                    <div class="mb-3">
                        <label for="monthlyBudget" class="form-label">ì›” ì˜ˆì‚°</label>
                        <input type="number" class="form-control" id="monthlyBudget" name="monthlyBudget"
                               placeholder="ì˜ˆ: 50000" min="10000" max="500000" required>
                    </div>

                    <!-- ì•”ë³´í—˜ íŠ¹í™” ì¡°ê±´ë“¤ -->
                    <div class="mb-3">
                        <label for="familyCancerHistory" class="form-label">ê°€ì¡± ì•” ë³‘ë ¥</label>
                        <select class="form-select" id="familyCancerHistory" name="familyCancerHistory">
                            <option value="false">ì—†ìŒ</option>
                            <option value="true">ìˆìŒ</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label for="preferredCoveragePeriod" class="form-label">ì„ í˜¸ ë³´ì¥ê¸°ê°„</label>
                        <select class="form-select" id="preferredCoveragePeriod" name="preferredCoveragePeriod">
                            <option value="">ìƒê´€ì—†ìŒ</option>
                            <option value="10ë…„">10ë…„</option>
                            <option value="20ë…„">20ë…„</option>
                            <option value="ì¢…ì‹ ">ì¢…ì‹ </option>
                        </select>
                    </div>

                    <!-- ì•” ì¢…ë¥˜ ì„ í˜¸ë„ì™€ ë³´í—˜ë£Œ ë‚©ì… ë°©ë²•ì€ í˜„ì¬ ë°ì´í„°ì— íŠ¹í™” ìƒí’ˆì´ ì—†ì–´ì„œ ì œê±° -->

                    <div class="mb-4">
                        <label for="topN" class="form-label">ì¶”ì²œ ìƒí’ˆ ê°œìˆ˜</label>
                        <select class="form-select" id="topN" name="topN">
                            <option value="5">5ê°œ</option>
                            <option value="10" selected>10ê°œ</option>
                            <option value="15">15ê°œ</option>
                            <option value="20">20ê°œ</option>
                        </select>
                    </div>

                    <button type="submit" class="btn btn-recommend">
                        <i class="fas fa-search me-2"></i>ë§ì¶¤í˜• ì•”ë³´í—˜ ì°¾ê¸°
                    </button>
                </form>
            </div>
        </div>

        <!-- ì˜¤ë¥¸ìª½ ê²°ê³¼ í‘œì‹œ -->
        <div class="col-md-8">
            <div class="results-section">
                <div class="initial-message" id="initialMessage">
                    <i class="fas fa-user-md fa-3x mb-3" style="color: #6c757d;"></i>
                    <h5 style="font-weight: 700; color: #333; margin-bottom: 0.5rem;">ì™¼ìª½ ì„¤ì •ì„ ì¡°ì •í•˜ê³  "ë§ì¶¤í˜• ì•”ë³´í—˜ ì°¾ê¸°"ë¥¼ í´ë¦­í•˜ì„¸ìš”!</h5>
                    <p style="color: #999; font-size: 1rem;">ë‹¹ì‹ ì—ê²Œ ìµœì í™”ëœ ì•”ë³´í—˜ì„ ì°¾ì•„ë“œë¦½ë‹ˆë‹¤.</p>
                </div>

                <div class="loading" id="loading" style="display: none;">
                    <div class="spinner-border" role="status">
                        <span class="visually-hidden">ë¡œë”©ì¤‘...</span>
                    </div>
                    <p class="mt-2">ìµœì ì˜ ì•”ë³´í—˜ì„ ì°¾ê³  ìˆìŠµë‹ˆë‹¤...</p>
                </div>

                <div id="results" style="display: none;">
                    <div class="result-count" id="resultCount"></div>
                    <div id="resultsList"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // í¼ ì œì¶œ ì´ë²¤íŠ¸
    document.getElementById('profileForm').addEventListener('submit', function(e) {
        e.preventDefault();

        const formData = new FormData(this);
        const data = {
            age: parseInt(formData.get('age')),
            sex: formData.get('sex'),
            smoker_flag: 0, // ê¸°ë³¸ê°’: ë¹„í¡ì—°
            monthly_budget: parseInt(formData.get('monthlyBudget')),
            // ì•”ë³´í—˜ íŠ¹í™” ì¡°ê±´ë“¤
            family_cancer_history: formData.get('familyCancerHistory') === 'true',
            preferred_coverage_period: formData.get('preferredCoveragePeriod') || null,
            top_n: parseInt(formData.get('topN'))
        };

        // ë¡œë”© í‘œì‹œ
        document.getElementById('loading').style.display = 'block';
        document.getElementById('results').style.display = 'none';
        document.getElementById('initialMessage').style.display = 'none';

        // API í˜¸ì¶œ
        fetch('/cancer/profile-recommend/api', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(data => {
            document.getElementById('loading').style.display = 'none';
            displayResults(data);
        })
        .catch(error => {
            document.getElementById('loading').style.display = 'none';
            console.error('Error:', error);
            alert('ì¶”ì²œ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        });
    });

    function displayResults(data) {
        const resultsDiv = document.getElementById('results');
        const resultsList = document.getElementById('resultsList');
        const resultCount = document.getElementById('resultCount');

        if (data.recommendations && data.recommendations.length > 0) {
            resultCount.textContent = `ì´ ${data.recommendations.length}ê°œì˜ ìƒí’ˆì„ ì°¾ì•˜ìŠµë‹ˆë‹¤`;
            resultsList.innerHTML = '';

            data.recommendations.forEach((product, index) => {
                const card = document.createElement('div');
                card.className = 'result-card';
                card.innerHTML = `
                    <div class="product-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <div class="company-name">${product.insuranceCompany || 'ì •ë³´ì—†ìŒ'}</div>
                                <div class="product-name">${product.productName || 'ìƒí’ˆëª… ì—†ìŒ'}</div>
                            </div>
                            <div class="text-end">
                                <div class="coverage-summary" onclick="toggleCoverageDetails(${index})">
                                    <span class="coverage-icon">ğŸ›¡ï¸</span>
                                    <span class="coverage-text">ë³´ì¥ ë‚´ìš© ë³´ê¸°</span>
                                    <span class="coverage-arrow">â–¼</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="product-details">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="detail-item">
                                    <div class="detail-label">ë³´ì¥ê¸ˆì•¡</div>
                                    <div class="detail-value">${product.coverageAmount ? product.coverageAmount.toLocaleString() + 'ì›' : 'ì •ë³´ì—†ìŒ'}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">ì›” ë³´í—˜ë£Œ</div>
                                    <div class="detail-value">${product.avgPremium ? product.avgPremium.toLocaleString() + 'ì›' : 'ì •ë³´ì—†ìŒ'}</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="detail-item">
                                    <div class="detail-label">ê°±ì‹ í˜•íƒœ</div>
                                    <div class="detail-value">${product.renewalCycle || 'ì •ë³´ì—†ìŒ'}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">íŒë§¤ì±„ë„</div>
                                    <div class="detail-value">${product.salesChannel || 'ì •ë³´ì—†ìŒ'}</div>
                                </div>
                            </div>
                        </div>
                        <div class="coverage-details" id="details-${index}" style="display: none;">
                            <div class="coverage-content">
                                <h6>ì£¼ìš” ë³´ì¥ ë‚´ìš©</h6>
                                <div class="coverage-content" data-product-index="${index}">
                                    <div class="coverage-item">ë³´ì¥ ë‚´ìš© ë¡œë”© ì¤‘...</div>
                                </div>
                                <div class="coverage-note">
                                    â€» ìƒì„¸í•œ ë³´ì¥ ì¡°ê±´ê³¼ ì§€ê¸‰ í•œë„ëŠ” ê° ìƒí’ˆì˜ ì•½ê´€ì„ ì°¸ì¡°í•˜ì„¸ìš”.
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                // ë³´ì¥ ë‚´ìš© ë™ì  ë Œë”ë§
                const coverageContentDiv = card.querySelector('[data-product-index="' + index + '"]');
                if (product.coverageDetails && product.coverageDetails.length > 0) {
                    coverageContentDiv.innerHTML = product.coverageDetails.map(detail =>
                        `<div class="coverage-item">${detail}</div>`
                    ).join('');
                } else {
                    coverageContentDiv.innerHTML = '<div class="coverage-item">ë³´ì¥ ë‚´ìš© ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
                }

                resultsList.appendChild(card);
            });

            resultsDiv.style.display = 'block';
        } else {
            resultCount.textContent = 'ì¡°ê±´ì— ë§ëŠ” ìƒí’ˆì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤';
            resultsList.innerHTML = '<div class="alert alert-warning">ì¡°ê±´ì— ë§ëŠ” ìƒí’ˆì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
            resultsDiv.style.display = 'block';
        }
    }

    function toggleCoverageDetails(index) {
        const detailsDiv = document.getElementById(`details-${index}`);
        const arrow = event.target.closest('.coverage-summary').querySelector('.coverage-arrow');

        // ë‹¤ë¥¸ ëª¨ë“  ë³´ì¥ ë‚´ìš© ìˆ¨ê¸°ê¸°
        document.querySelectorAll('.coverage-details').forEach(div => {
            if (div.id !== `details-${index}`) {
                div.style.display = 'none';
            }
        });

        // í˜„ì¬ ë³´ì¥ ë‚´ìš© í† ê¸€
        if (detailsDiv.style.display === 'none') {
            detailsDiv.style.display = 'block';
            arrow.textContent = 'â–²';
        } else {
            detailsDiv.style.display = 'none';
            arrow.textContent = 'â–¼';
        }
    }
</script>
</body>
</html>

