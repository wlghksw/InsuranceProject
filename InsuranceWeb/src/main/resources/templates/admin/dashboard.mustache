<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
    <title>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ - ê±°ë¶ì´ ë³´í—˜</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        /* [ë³‘í•©] ê¸°ì¡´ ë©”ì¸ í˜ì´ì§€ ë ˆì´ì•„ì›ƒ ìŠ¤íƒ€ì¼ */
        html, body {
            margin: 0; padding: 0; scroll-behavior: smooth; font-family: 'Noto Sans KR', sans-serif;
        }
        .custom-navbar {
            background-color: #fcf8f0; border-bottom: 1px solid #e0e0e0; padding: 1rem 1.5rem;
            position: fixed; width: 100%; top: 0; z-index: 1000;
        }
        .custom-navbar .navbar-brand {
            font-weight: 700; color: #17ec42; font-size: 1.8rem;
        }
        .scroll-section {
            min-height: 100vh; display: flex; align-items: center; justify-content: center;
            padding: 8rem 2rem 2rem 2rem; box-sizing: border-box;
        }
        #section1 { background: #dcfbca; }
        #section2 { background: #a5fa8e; }
        .side-nav {
            position: fixed; right: 20px; top: 50%; transform: translateY(-50%);
            z-index: 1000; list-style: none; margin: 0; padding: 0;
            display: flex; flex-direction: column; gap: 15px;
        }
        .side-nav li a {
            display: block; width: 12px; height: 12px; background-color: #ccc;
            border-radius: 50%; transition: background-color 0.3s ease; text-indent: -9999px;
        }
        .side-nav li a.active { background-color: #17ec42; }

        /* [ë³‘í•©] ê¸°ì¡´ ëŒ€ì‹œë³´ë“œ í…Œì´ë¸” ë° ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .table-container { width: 100%; background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #333; margin-bottom: 1.5rem; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #e0e0e0; padding: 12px; text-align: center; }
        th { background-color: #f2f2f2; font-weight: bold; }
        tr:nth-child(even) { background-color: #fafafa; }
        .btn { padding: 6px 12px; border: none; border-radius: 4px; cursor: pointer; color: white; font-size: 0.9em; margin: 2px; min-width: 80px; }
        .btn-role-admin { background-color: #34495E; }
        .btn-role-user { background-color: #f39c12; }
        .btn-withdraw { background-color: #e74c3c; }
        .btn-restore { background-color: #3498db; }
        .btn-delete { background-color: #c0392b; }
        .user-status { font-weight: bold; }
        .status-active { color: #27AE60; }
        .status-inactive { color: #C0392B; }
    </style>
</head>
<body>

<!-- ì¸¡ë©´ ë‚´ë¹„ê²Œì´ì…˜ -->
<ul class="side-nav">
    <li><a href="#section1">íšŒì› ê´€ë¦¬</a></li>
    <li><a href="#section2">ì¶”ê°€ ì„¹ì…˜</a></li>
</ul>

<!-- ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
<nav class="navbar navbar-expand-lg custom-navbar">
    <div class="container-fluid">
        <a class="navbar-brand" href="/main">ğŸ¢ê±°ë¶ì´ ë³´í—˜ (ê´€ë¦¬ì)</a>
        <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <span class="nav-link text-dark">ì•ˆë…•í•˜ì„¸ìš”. <span class="fw-bold">{{loginAdminName}}</span>ë‹˜</span>
                </li>
                <li class="nav-item ms-2">
                    <form action="/logout" method="post" class="d-inline">
                        <button type="submit" class="btn btn-secondary">ë¡œê·¸ì•„ì›ƒ</button>
                    </form>
                </li>
            </ul>
        </div>
    </div>
</nav>

<main>
    <!-- ì„¹ì…˜ 1: íšŒì› ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ -->
    <section id="section1" class="scroll-section">
        <div class="table-container">
            <h1>íšŒì› ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ</h1>
            <table>
                <thead>
                <tr>
                    <th>ID</th>
                    <th>ë¡œê·¸ì¸ ì•„ì´ë””</th>
                    <th>ì´ë¦„</th>
                    <th>ê°€ì…ì¼</th>
                    <th>ìƒíƒœ</th>
                    <th>ì—­í• </th>
                    <th>ê´€ë¦¬</th>
                </tr>
                </thead>
                <tbody>
                {{#users}}
                    <tr>
                        <td>{{id}}</td>
                        <td>{{loginId}}</td>
                        <td>{{realName}}</td>
                        <td>{{createdAt}}</td>
                        <td>
                            {{#isActive}}<span class="user-status status-active">í™œì„±</span>{{/isActive}}
                            {{^isActive}}<span class="user-status status-inactive">ë¹„í™œì„±</span>{{/isActive}}
                        </td>
                        <td>{{role}}</td>
                        <td>
                            {{#admin}}<button class="btn btn-role-user" onclick="updateRole('{{id}}', 'USER')">ì‚¬ìš©ìë¡œ</button>{{/admin}}
                            {{^admin}}<button class="btn btn-role-admin" onclick="updateRole('{{id}}', 'ADMIN')">ê´€ë¦¬ìë¡œ</button>{{/admin}}
                            {{#isActive}}<button class="btn btn-withdraw" onclick="toggleUserStatus('{{id}}', false)">ë¹„í™œì„±í™”</button>{{/isActive}}
                            {{^isActive}}<button class="btn btn-restore" onclick="toggleUserStatus('{{id}}', true)">í™œì„±í™”</button>{{/isActive}}
                            <button onclick="deleteUser('{{id}}')" class="btn btn-delete">ì˜êµ¬ ì‚­ì œ</button>
                        </td>
                    </tr>
                {{/users}}
                {{^users}}
                    <tr>
                        <td colspan="7" class="text-center p-4">ë“±ë¡ëœ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.</td>
                    </tr>
                {{/users}}
                </tbody>
            </table>
        </div>
    </section>

    <!-- ì„¹ì…˜ 2: ì¶”ê°€ ì½˜í…ì¸  ì˜ì—­ -->
    <section id="section2" class="scroll-section">
        <div class="text-center">
            <h2>ì¶”ê°€ ê´€ë¦¬ì ê¸°ëŠ¥</h2>
            <p>ì´ê³³ì— ë‹¤ë¥¸ ê´€ë¦¬ì ë©”ë‰´ë‚˜ í†µê³„ ë“±ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        </div>
    </section>
</main>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // [ë³‘í•©] ìŠ¤í¬ë¡¤ ì• ë‹ˆë©”ì´ì…˜ ìŠ¤í¬ë¦½íŠ¸
    document.addEventListener('DOMContentLoaded', () => {
        const sections = document.querySelectorAll('.scroll-section');
        const navLinks = document.querySelectorAll('.side-nav a');

        function updateActiveState() {
            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                if (window.scrollY >= sectionTop - (window.innerHeight / 2)) {
                    current = section.getAttribute('id');
                }
            });

            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href').includes(current)) {
                    link.classList.add('active');
                }
            });
        }
        window.addEventListener('scroll', updateActiveState);
        updateActiveState(); // ì´ˆê¸° ë¡œë“œ ì‹œ ì‹¤í–‰
    });

    // [ë³‘í•©] ê´€ë¦¬ì ê¸°ëŠ¥ API í˜¸ì¶œ ìŠ¤í¬ë¦½íŠ¸
    function updateRole(userId, newRole) {
        const roleKor = newRole === 'ADMIN' ? 'ê´€ë¦¬ì' : 'ì‚¬ìš©ì';
        if (!confirm(`ì‚¬ìš©ì ID ${userId}ì˜ ì—­í• ì„ ${roleKor}(ìœ¼)ë¡œ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
        fetch(`/admin/users/${userId}/role`, {
            method: 'POST', headers: { 'Content-Type': 'application/x-www-form-urlencoded' }, body: `role=${newRole}`
        }).then(handleResponse).catch(handleError);
    }
    function toggleUserStatus(userId, shouldRestore) {
        const action = shouldRestore ? 'í™œì„±í™”' : 'ë¹„í™œì„±í™”';
        const url = shouldRestore ? `/admin/users/${userId}/restore` : `/admin/users/${userId}/withdraw`;
        if (!confirm(`ì‚¬ìš©ì ID ${userId}ë¥¼ ${action} ìƒíƒœë¡œ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
        fetch(url, { method: 'POST' }).then(handleResponse).catch(handleError);
    }
    function deleteUser(userId) {
        if (!confirm(`[ê²½ê³ ] ì‚¬ìš©ì ID ${userId}ë¥¼ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œí•©ë‹ˆë‹¤. ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) return;
        fetch(`/admin/users/${userId}`, { method: 'DELETE' }).then(handleResponse).catch(handleError);
    }
    function handleResponse(response) {
        if (response.ok) {
            alert('ì‘ì—…ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
            window.location.reload();
        } else {
            response.text().then(text => alert(`ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${text}`));
        }
    }
    function handleError(error) {
        console.error('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜:', error);
        alert('ì„œë²„ì™€ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
</script>
</body>
</html>