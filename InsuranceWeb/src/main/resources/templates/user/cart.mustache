<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
    <title>관심 상품 - 거북이 보험</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"/>
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f8f9fa;
            padding-top: 80px;
        }
        .custom-navbar {
            background-color: #1c2f48;
            border-bottom: 1px solid rgba(0,0,0,.25);
            padding: 14px 20px;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }
        .custom-navbar .navbar-brand {
            color: #d4b46b !important;
            font-weight: 900;
            font-size: 32px;
        }
        .custom-navbar .nav-link {
            color: #d4b46b !important;
            font-weight: 700;
            font-size: 18px;
            margin-right: 24px;
        }
        .custom-navbar .nav-link:hover {
            color: #e5c57b !important;
        }
        .cart-container {
            background: white;
            border-radius: 15px;
            padding: 2.5rem;
            box-shadow: 0 4px 20px rgba(28,47,72,0.1);
            margin-bottom: 3rem;
        }
        .cart-container h2 {
            color: #1c2f48;
            font-weight: 700;
            border-bottom: 3px solid #d4b46b;
            padding-bottom: 1rem;
            margin-bottom: 2rem;
        }
        .cart-item {
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }
        .cart-item:hover {
            border-color: #d4b46b;
            box-shadow: 0 4px 12px rgba(212,180,107,0.2);
        }
        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }
        .item-type {
            background-color: #1c2f48;
            color: #d4b46b;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        .item-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: #1c2f48;
            margin-bottom: 0.5rem;
        }
        .item-company {
            color: #666;
            font-size: 0.9rem;
        }
        .item-details {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        .detail-item {
            display: flex;
            flex-direction: column;
        }
        .detail-label {
            color: #666;
            font-size: 0.85rem;
            margin-bottom: 0.25rem;
        }
        .detail-value {
            color: #333;
            font-weight: 600;
        }
        .btn-remove {
            background-color: #dc3545;
            border-color: #dc3545;
            color: white;
        }
        .btn-remove:hover {
            background-color: #c82333;
            border-color: #bd2130;
        }
        .empty-cart {
            text-align: center;
            padding: 4rem 2rem;
            color: #666;
        }
        .empty-cart i {
            font-size: 4rem;
            color: #d4b46b;
            margin-bottom: 1rem;
        }
        .btn-primary {
            background-color: #1c2f48;
            border-color: #1c2f48;
            color: #d4b46b;
        }
        .btn-primary:hover {
            background-color: #2a4a6f;
            border-color: #2a4a6f;
        }
        .nav-tabs .nav-link {
            color: #1c2f48;
            font-weight: 600;
        }
        .nav-tabs .nav-link.active {
            color: #d4b46b;
            background-color: #1c2f48;
        }
    </style>
</head>
<body>
    <!-- 네비게이션 바 -->
    <nav class="navbar navbar-expand-lg custom-navbar">
        <div class="container-fluid">
            <a class="navbar-brand" href="/main" style="color:#d4b46b; font-weight:900;">
                B
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/main">홈</a>
                <a class="nav-link" href="/cart">
                    관심 상품
                    <span class="badge bg-danger ms-1" id="cart-count-badge">{{cartCount}}</span>
                </a>
                <span class="nav-link">{{user.nickname}}님</span>
                <form action="/logout" method="post" class="d-inline">
                    <button type="submit" class="btn btn-sm btn-outline-light">로그아웃</button>
                </form>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="cart-container">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="mb-0">
                    관심 상품
                    <span class="badge bg-secondary ms-2">{{cartCount}}개</span>
                </h2>
            </div>

            {{^cartItems.0}}
            <div class="empty-cart">
                <i class="fas fa-inbox"></i>
                <h4>관심 상품이 없습니다</h4>
                <p class="text-muted">마음에 드는 보험 상품을 추가해보세요!</p>
                <div class="mt-4">
                    <a href="/cancer/recommend" class="btn btn-primary me-2">암보험 추천</a>
                    <a href="/accident/recommend" class="btn btn-primary me-2">상해보험 추천</a>
                    <a href="/savings-insurance/recommend" class="btn btn-primary">저축성보험 추천</a>
                </div>
            </div>
            {{/cartItems.0}}

            <!-- 탭으로 보험 유형별 구분 -->
            {{#cartItems.0}}
            <ul class="nav nav-tabs mb-3" id="cartTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="all-tab" data-bs-toggle="tab" data-bs-target="#all" type="button">
                        전체 ({{cartCount}})
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="cancer-tab" data-bs-toggle="tab" data-bs-target="#cancer" type="button">
                        암보험
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="accident-tab" data-bs-toggle="tab" data-bs-target="#accident" type="button">
                        상해보험
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="savings-tab" data-bs-toggle="tab" data-bs-target="#savings" type="button">
                        저축성보험
                    </button>
                </li>
            </ul>

            <div class="tab-content" id="cartTabsContent">
                <!-- 전체 탭 (JavaScript로 동적 생성) -->
                <div class="tab-pane fade show active" id="all" role="tabpanel"></div>

                <!-- 암보험, 상해보험, 저축성보험 탭 -->
                <div class="tab-pane fade" id="cancer" role="tabpanel"></div>
                <div class="tab-pane fade" id="accident" role="tabpanel"></div>
                <div class="tab-pane fade" id="savings" role="tabpanel"></div>
            </div>
            {{/cartItems.0}}
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 장바구니 아이템 데이터
        const cartItems = [
            {{#cartItems}}
            {
                id: {{id}},
                insuranceType: "{{insuranceType}}",
                insuranceCompany: "{{insuranceCompany}}",
                productName: "{{productName}}",
                coverageAmount: "{{#coverageAmount}}{{coverageAmount}}{{/coverageAmount}}{{^coverageAmount}}{{/coverageAmount}}",
                malePremium: "{{#malePremium}}{{malePremium}}{{/malePremium}}{{^malePremium}}{{/malePremium}}",
                femalePremium: "{{#femalePremium}}{{femalePremium}}{{/femalePremium}}{{^femalePremium}}{{/femalePremium}}",
                monthlyPremium: "{{#monthlyPremium}}{{monthlyPremium}}{{/monthlyPremium}}{{^monthlyPremium}}{{/monthlyPremium}}",
                guaranteedRate: "{{#guaranteedRate}}{{guaranteedRate}}{{/guaranteedRate}}{{^guaranteedRate}}{{/guaranteedRate}}",
                currentRate: "{{#currentRate}}{{currentRate}}{{/currentRate}}{{^currentRate}}{{/currentRate}}",
                renewalCycle: "{{#renewalCycle}}{{renewalCycle}}{{/renewalCycle}}{{^renewalCycle}}{{/renewalCycle}}",
                term: "{{#term}}{{term}}{{/term}}{{^term}}{{/term}}",
                recommendationReason: "{{#recommendationReason}}{{recommendationReason}}{{/recommendationReason}}{{^recommendationReason}}{{/recommendationReason}}"
            }{{^last}},{{/last}}
            {{/cartItems}}
        ];

        // 탭별로 필터링하여 표시
        document.addEventListener('DOMContentLoaded', function() {
            renderAllItems(); // 전체 탭 렌더링
            renderFilteredItems('암보험', '#cancer');
            renderFilteredItems('상해보험', '#accident');
            renderFilteredItems('저축성보험', '#savings');
        });

        // 전체 탭 렌더링
        function renderAllItems() {
            const container = document.querySelector('#all');
            if (!container || cartItems.length === 0) return;

            container.innerHTML = cartItems.map(item => `
                <div class="cart-item" id="cart-item-${item.id}">
                    <div class="item-header">
                        <div>
                            <span class="item-type">${item.insuranceType}</span>
                            <div class="item-title mt-2">${item.productName}</div>
                            <div class="item-company">${item.insuranceCompany}</div>
                        </div>
                        <button class="btn btn-sm btn-remove" onclick="removeFromCart(${item.id})">
                            <i class="fas fa-trash me-1"></i>삭제
                        </button>
                    </div>
                    <div class="item-details">
                        ${item.coverageAmount ? `<div class="detail-item"><span class="detail-label">보장금액</span><span class="detail-value">${item.coverageAmount}</span></div>` : ''}
                        ${item.malePremium ? `<div class="detail-item"><span class="detail-label">남성 보험료</span><span class="detail-value">${item.malePremium}</span></div>` : ''}
                        ${item.femalePremium ? `<div class="detail-item"><span class="detail-label">여성 보험료</span><span class="detail-value">${item.femalePremium}</span></div>` : ''}
                        ${item.monthlyPremium ? `<div class="detail-item"><span class="detail-label">월 납입금</span><span class="detail-value">${item.monthlyPremium}</span></div>` : ''}
                        ${item.guaranteedRate ? `<div class="detail-item"><span class="detail-label">최저보증이율</span><span class="detail-value">${item.guaranteedRate}</span></div>` : ''}
                        ${item.currentRate ? `<div class="detail-item"><span class="detail-label">현재공시이율</span><span class="detail-value">${item.currentRate}</span></div>` : ''}
                        ${item.renewalCycle ? `<div class="detail-item"><span class="detail-label">갱신주기</span><span class="detail-value">${item.renewalCycle}</span></div>` : ''}
                        ${item.term ? `<div class="detail-item"><span class="detail-label">보험기간</span><span class="detail-value">${item.term}</span></div>` : ''}
                    </div>
                </div>
            `).join('');
        }

        function renderFilteredItems(type, selector) {
            const container = document.querySelector(selector);
            const filtered = cartItems.filter(item => item.insuranceType === type);

            if (filtered.length === 0) {
                container.innerHTML = '<div class="empty-cart"><p>해당 유형의 상품이 없습니다.</p></div>';
                return;
            }

            container.innerHTML = filtered.map(item => `
                <div class="cart-item" id="cart-item-${item.id}">
                    <div class="item-header">
                        <div>
                            <span class="item-type">${item.insuranceType}</span>
                            <div class="item-title mt-2">${item.productName}</div>
                            <div class="item-company">${item.insuranceCompany}</div>
                        </div>
                        <button class="btn btn-sm btn-remove" onclick="removeFromCart(${item.id})">
                            <i class="fas fa-trash me-1"></i>삭제
                        </button>
                    </div>
                    <div class="item-details">
                        ${item.coverageAmount ? `<div class="detail-item"><span class="detail-label">보장금액</span><span class="detail-value">${item.coverageAmount}</span></div>` : ''}
                        ${item.malePremium ? `<div class="detail-item"><span class="detail-label">남성 보험료</span><span class="detail-value">${item.malePremium}</span></div>` : ''}
                        ${item.femalePremium ? `<div class="detail-item"><span class="detail-label">여성 보험료</span><span class="detail-value">${item.femalePremium}</span></div>` : ''}
                        ${item.monthlyPremium ? `<div class="detail-item"><span class="detail-label">월 납입금</span><span class="detail-value">${item.monthlyPremium}</span></div>` : ''}
                        ${item.guaranteedRate ? `<div class="detail-item"><span class="detail-label">최저보증이율</span><span class="detail-value">${item.guaranteedRate}</span></div>` : ''}
                        ${item.currentRate ? `<div class="detail-item"><span class="detail-label">현재공시이율</span><span class="detail-value">${item.currentRate}</span></div>` : ''}
                    ${item.renewalCycle ? `<div class="detail-item"><span class="detail-label">갱신주기</span><span class="detail-value">${item.renewalCycle}</span></div>` : ''}
                    ${item.term ? `<div class="detail-item"><span class="detail-label">보험기간</span><span class="detail-value">${item.term}</span></div>` : ''}
                </div>
            </div>
            `).join('');
        }

        // 관심 상품에서 삭제
        function removeFromCart(cartId) {
            if (!confirm('이 상품을 관심 상품에서 삭제하시겠습니까?')) {
                return;
            }

            fetch(`/cart/${cartId}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(data.message);
                    location.reload(); // 페이지 새로고침
                } else {
                    alert(data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('오류가 발생했습니다.');
            });
        }
    </script>
</body>
</html>

